{
    "title": "Contracts",
    "uid": "soroban-contracts",
    "tags": [
        "soroban"
    ],
    "refresh": "30s",
    "time": {
        "from": "now-24h",
        "to": "now"
    },
    "panels": [
        {
            "id": 1,
            "type": "stat",
            "title": "Contracts Published (24h)",
            "gridPos": {
                "x": 0,
                "y": 0,
                "w": 6,
                "h": 4
            },
            "datasource": "Prometheus",
            "targets": [
                {
                    "expr": "increase(soroban_contracts_published_total[24h])",
                    "legendFormat": "published"
                }
            ]
        },
        {
            "id": 2,
            "type": "stat",
            "title": "Contracts Verified (24h)",
            "gridPos": {
                "x": 6,
                "y": 0,
                "w": 6,
                "h": 4
            },
            "datasource": "Prometheus",
            "targets": [
                {
                    "expr": "increase(soroban_contracts_verified_total[24h])",
                    "legendFormat": "verified"
                }
            ]
        },
        {
            "id": 3,
            "type": "stat",
            "title": "Verification p99 Latency",
            "gridPos": {
                "x": 12,
                "y": 0,
                "w": 6,
                "h": 4
            },
            "datasource": "Prometheus",
            "targets": [
                {
                    "expr": "histogram_quantile(0.99, sum(rate(soroban_verification_latency_seconds_bucket[5m])) by (le))",
                    "legendFormat": "p99"
                }
            ],
            "fieldConfig": {
                "defaults": {
                    "unit": "s"
                }
            }
        },
        {
            "id": 4,
            "type": "stat",
            "title": "Publish Rate (1m)",
            "gridPos": {
                "x": 18,
                "y": 0,
                "w": 6,
                "h": 4
            },
            "datasource": "Prometheus",
            "targets": [
                {
                    "expr": "sum(rate(soroban_contracts_published_total[1m]))",
                    "legendFormat": "contracts/s"
                }
            ]
        },
        {
            "id": 5,
            "type": "timeseries",
            "title": "Contract Publishes by Network",
            "gridPos": {
                "x": 0,
                "y": 4,
                "w": 12,
                "h": 8
            },
            "datasource": "Prometheus",
            "targets": [
                {
                    "expr": "sum by (network) (rate(soroban_contracts_published_total[5m]))",
                    "legendFormat": "{{ network }}"
                }
            ]
        },
        {
            "id": 6,
            "type": "timeseries",
            "title": "Verification Latency Histogram",
            "gridPos": {
                "x": 12,
                "y": 4,
                "w": 12,
                "h": 8
            },
            "datasource": "Prometheus",
            "targets": [
                {
                    "expr": "histogram_quantile(0.50, sum(rate(soroban_verification_latency_seconds_bucket[5m])) by (le))",
                    "legendFormat": "p50"
                },
                {
                    "expr": "histogram_quantile(0.95, sum(rate(soroban_verification_latency_seconds_bucket[5m])) by (le))",
                    "legendFormat": "p95"
                },
                {
                    "expr": "histogram_quantile(0.99, sum(rate(soroban_verification_latency_seconds_bucket[5m])) by (le))",
                    "legendFormat": "p99"
                }
            ],
            "fieldConfig": {
                "defaults": {
                    "unit": "s"
                }
            }
        },
        {
            "id": 7,
            "type": "logs",
            "title": "Contract Error Logs",
            "gridPos": {
                "x": 0,
                "y": 12,
                "w": 24,
                "h": 8
            },
            "datasource": "Loki",
            "targets": [
                {
                    "expr": "{app=\"soroban-registry\"} |= \"ERROR\" | json | line_format \"{{.message}}\""
                }
            ]
        }
    ]
}